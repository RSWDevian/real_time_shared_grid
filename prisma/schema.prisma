//* This is the Prisma Schema file for the generating the database structure at Supabase
generator client {
  provider = "prisma-client-js"
}

//? The db source file location
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

//? The User model representing the users of the application
model User {
  id           String      @id @default(uuid()) @db.Uuid
  username     String?     @unique
  email        String      @unique
  passwordHash String      @map("password_hash")
  createdAt    DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime?   @map("updated_at") @db.Timestamptz(6)
  ownerships   Ownership[]  @relation("OwnershipUser")
  gridBlocks   GridBlock[]  @relation("GridBlockUser")

  @@map("users")
}

//? The Ownership model representing the models of the ownership data
model Ownership {
  blockId   String    @id @map("block_id")
  owner     String
  boughtAt DateTime  @default(now()) @map("bought_at") @db.Timestamptz(6)
  soldAt DateTime?  @map("sold_at") @db.Timestamptz(6)
  user      User      @relation("OwnershipUser", fields: [owner], references: [email])
  gridBlock GridBlock  @relation(fields: [blockId], references: [blockId])

  @@map("ownership")
}

//? The GridBlock model representing grid cell state
model GridBlock {
  blockId    String     @id @map("block_id")
  occupied   Boolean    @default(false)
  owner      String?
  createdAt  DateTime   @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime   @default(now()) @map("updated_at") @db.Timestamptz(6)
  user       User?      @relation("GridBlockUser", fields: [owner], references: [email], onDelete: SetNull)
  ownership  Ownership?

  @@map("grid_blocks")
}